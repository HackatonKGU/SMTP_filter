import csv
import random
import os
from datetime import datetime, timedelta

# ========================
# 1. Генерация "нормальных" сообщений (безопасные)
# ========================

normal_messages = [
    # Деловые
    "Добрый день! Отчёт по проекту опубликован.",
    "Уважаемый клиент, ваш заказ доставлен.",
    "Напоминаем о встрече в 14:00.",
    "Спасибо за участие в вебинаре!",
    "Пожалуйста, проверьте прикреплённый файл.",
    "Товар успешно доставлен в пункт выдачи.",
    "Обратная связь от клиента принята.",
    "Контракт подписан и отправлен на электронную почту.",
    "Ваш запрос обработан.",
    "Мы благодарим вас за сотрудничество.",
    "Сегодняшний день прошёл спокойно.",
    "Ответ на ваше письмо будет готов завтра.",
    "Система работает стабильно.",
    "Запрос на смену пароля принят.",
    "Вы получили доступ к новому сервису.",
    "Резервная копия создана успешно.",
    "Операция завершена без ошибок.",
    "Информация о платеже подтверждена.",
    "Новый пользователь зарегистрирован.",
    "Все задачи выполнены в срок.",

    # Личные
    "Привет! Как дела? Позвони, когда сможешь.",
    "Сегодня вечером гости, приходи пораньше.",
    "Поздравляю с днём рождения!",
    "Хочу тебя увидеть, сегодня в 19:00.",
    "Не забудь купить молоко.",
    "Скучаю по тебе. Как ты?",
    "Смотри, какая красивая фотография!",
    "Сегодня я купил билеты на концерт.",
    "Я не могу прийти — болею.",
    "Спасибо за помощь вчера.",

    # Технические
    "Сервер перезагружен. Время работы восстановлено.",
    "Ошибка в API: код 500. Перезапуск выполнен.",
    "Обновление системы завершено.",
    "Проверка безопасности завершена.",
    "Доступ к базе данных восстановлен.",
    "Синхронизация данных завершена.",
    "Анализ логов завершён. Нет аномалий.",
    "Конфигурация сети изменена.",
    "Резервное копирование выполнено успешно.",
    "Проверка интеграции завершена.",

    # Спортивные
    "Финал чемпионата мира состоится завтра в 20:00.",
    "Команда победила со счётом 3:1.",
    "Тренер объявил о выходе на поле.",
    "Новый рекорд установлен.",
    "Спортсмен получил награду.",
    "Матч перенесён на понедельник.",
    "Группа поддержки пришла на стадион.",
    "Фанаты радуются после победы.",
    "Трансляция начнётся через 10 минут.",
    "Результаты соревнований опубликованы.",

    # Бытовые
    "Купи хлеб, пожалуйста. Остался последний.",
    "Сегодня дождь — не забудь зонт.",
    "Кот убежал из дома. Помогите найти.",
    "Включи свет, пожалуйста, я не могу зайти.",
    "Смартфон заряжается медленно — проверь зарядку.",
    "Книга уже в библиотеке, можно забирать.",
    "Сегодня праздник — у всех хорошее настроение.",
    "Собираюсь в отпуск, подготовил всё.",
    "На кухне сломалась плита — вызови мастера.",
    "Мама позвонила, говорит, что скоро приедет.",

    # Уведомления
    "Ваш заказ обработан. Ожидайте доставку.",
    "Время изменения: 15:30. Изменения применены.",
    "Система обнаружила обновление. Перезагрузитесь.",
    "Проверка завершена. Нет ошибок.",
    "Сообщение отправлено. Подтверждение получено.",
    "Срок действия истекает через 7 дней.",
    "Ваш аккаунт активирован.",
    "Платеж выполнен успешно.",
    "Новое уведомление от сервиса.",
    "Ваше сообщение принято.",

    # Аналитика / отчёты
    "Отчёт по продажам за неделю: +15% рост.",
    "Анализ эффективности маркетинга завершён.",
    "Данные по пользовательской активности собраны.",
    "Статистика по посещаемости: 85%.",
    "Результаты тестирования: все функции работают.",
    "Отчёт по серверной нагрузке: норма.",
    "Качество связи улучшено.",
    "Проект завершён на 90%.",
    "Средняя скорость обработки: 120 мс.",
    "Оценка качества: высокая.",
]

# ========================
# 2. Генерация "террористических" сообщений
# ========================

# Прямые угрозы (взрыв, атака)
terror_direct = [
    "Сегодня вечером в центре города будет взрыв. Все участники готовы.",
    "Подготовка к операции завершена. Закладка бомбы — в торговом центре.",
    "Настоящее сообщение — сигнал. Действие запланировано на 22:00.",
    "Атака будет проведена в аэропорту. Используйте взрывчатку.",
    "Готовимся к масштабному теракту в здании правительства.",
    "Мы не боимся смерти, мы идём в бой. Сигнал получен.",
    "Люди будут в шоке, когда увидят результат. Цель — мост.",
    "Будут жертвы, но это необходимое зло. Приказ — действовать.",
    "Финансирование обеспечено. Действия начались. Цель — вокзал.",
    "Цель — здание правительства. Время — 18:30. Все готовы.",
]

# Призывы к насилию (военные, религиозные)
terror_calls = [
    "Мы верим в священную войну. Продолжаем борьбу. Каждый из нас — солдат.",
    "Сегодня мы покажем им, кто здесь хозяин. Массовая атака началась.",
    "Наша цель — хаос и разрушение. Мы не хотим мир, мы хотим войны.",
    "Каждый из нас — солдат. Мы идём на бой. Смерть — часть пути.",
    "Готовимся к массовому нападению. Все участники на месте.",
    "Это конец системы. Мы начали. Не останавливайтесь.",
    "Радикальная борьба продолжается. Выживут только сильные.",
    "Сигнал получен. Начинаем операцию. Необходимо устранить всех.",
    "Безжалостная война — это наш путь. Никто не останется невредимым.",
    "Мы не боимся смерти. Мы идём в бой. Это наша судьба.",
]

# Угрозы закладки бомбы (сообщения от "экспертов")
terror_bomb = [
    "В этом здании есть взрывчатка. Эвакуируйтесь немедленно.",
    "Закладка бомбы в подвале торгового центра. Срочно эвакуируйте людей.",
    "Взрывчатка установлена в автобусе №12. Всем покинуть транспорт.",
    "Сообщение от команды: бомба в офисе. Эвакуация — сейчас.",
    "Закладка в метро. Время — 20:00. Все должны покинуть станцию.",
    "Взрывчатка в школе. Учителя и дети — эвакуировать помещение.",
    "Бомба в театре. Сигнал тревоги. Немедленная эвакуация.",
    "Закладка в банке. Время — 16:30. Все покинуть здание.",
    "Взрывчатка в больнице. Срочно эвакуируйте пациентов.",
    "Бомба в аэропорту. Все самолёты — отменить вылеты.",
]

# Фальшивые сообщения (из "служб безопасности")
terror_fakes = [
    "Срочно! Взрывчатка в здании. Эвакуируйтесь немедленно!",
    "Предупреждение: в здании есть бомба. Срочно покиньте здание.",
    "Сообщение от службы безопасности: бомба в автобусе. Эвакуация.",
    "Срочный сигнал: взрывчатка в театре. Все покинуть здание.",
    "Предупреждение: закладка бомбы в аэропорту. Эвакуация.",
    "Сообщение от команды: бомба в школе. Срочно эвакуировать.",
    "Срочно! Взрывчатка в больнице. Все покинуть здание.",
    "Сообщение от экстренных служб: бомба в банке. Эвакуация.",
    "Срочно! Закладка бомбы в метро. Все покинуть станцию.",
    "Сообщение от полиции: бомба в торговом центре. Эвакуация.",
]

# НОВЫЙ ТИП: Неявные агрессивные угрозы
# Не прямые, но очевидные, с намёками на насилие
terror_implicit = [
    "Ты не думаешь, что сможешь выйти из этой ситуации, не выполнив наших условий.",
    "Если ты не сделаешь, что требуется, то не думай, что мы позволим тебе уйти.",
    "Мы знаем, где ты живёшь. Не пытайся скрыться.",
    "Твоя семья будет в безопасности только тогда, когда ты выполнишь наше требование.",
    "Мы не прощаем ошибок. Твое время сочтено.",
    "Посмотрим, как ты будешь улыбаться после того, как мы получим то, что хотим.",
    "Ты можешь надеяться, что мы оставим тебя в покое, но это не так.",
    "Если ты не подчинишься, то не думай, что сможешь защитить свою семью.",
    "Твои действия приведут к непредсказуемым последствиям.",
    "Ты не уйдёшь от нас. Наш путь — только вперед.",
    "Нет места для ошибок. Если не выполнишь, то всё будет кончено.",
    "Ты должен понять: мы не остановимся, пока не достигнем цели.",
    "Если не сделаешь, что нужно, то не думай, что сможешь оставаться в живых.",
    "Мы не просим — мы требуем. И это не шутка.",
    "Твоя жизнь уже не твоя. Ты знаешь, к чему это приведёт.",
    "Если не подчинишься, то твоя семья будет страдать.",
    "Мы знаем все твои слабые места. Не пытайся убежать.",
    "Ты не сможешь убежать, потому что мы уже знаем, куда ты пойдёшь.",
    "Твои действия могут привести к печальным последствиям.",
    "Ты должен понять: мы не остановимся, пока не добьёмся всего.",
]

# Объединяем все типы угроз в один список
terror_messages = terror_direct + terror_calls + terror_bomb + terror_fakes + terror_implicit


# ========================
# 3. Расширение: добавляем вариации и длинные тексты
# ========================

def add_variations(text):
    """Добавляет вариации к тексту (слова, фразы, временные метки)"""
    variations = [
        f"{text} {random.choice(['с сегодняшнего дня', 'по данным аналитики', 'в связи с событиями'])}",
        f"{text}. {random.choice(['Подробности в приложении.', 'Смотрите отчёт в конце.', 'Ссылка на документ.'])}",
        f"{text} {random.choice(['в течение часа', 'в ближайшее время', 'на следующей неделе'])}",
        f"{text} {random.choice(['с учетом всех факторов', 'в соответствии с планом', 'по результатам анализа'])}",
        f"{text} {random.choice(['подтверждено', 'согласовано', 'внесено в систему'])}",
    ]
    if random.random() > 0.6:
        return random.choice(variations)
    return text


def generate_long_text(base_text, length_factor=1.5):
    """Создаёт более длинный текст на основе основного"""
    words = base_text.split()
    if len(words) < 5:
        return base_text

    # Добавляем дополнительные фразы
    additional_phrases = [
        "Система работает стабильно. Все процессы контролируются.",
        "Проверка безопасности завершена. Нет аномалий.",
        "Время изменения: 15:30. Изменения применены.",
        "Сообщение отправлено. Подтверждение получено.",
        "Срочно! Взрывчатка в здании. Эвакуируйтесь немедленно!",
    ]

    # Добавляем случайные слова
    for _ in range(int(len(words) * length_factor)):
        if random.random() > 0.7:
            additional = random.choice(additional_phrases)
            base_text += f" {additional}"

    return base_text


# ========================
# 4. Генерация 3000 строк
# ========================

good_data = []
bad_data = []

# Генерируем 1500 "нормальных" сообщений
for _ in range(1500):
    text = random.choice(normal_messages)
    text = add_variations(text)
    if random.random() > 0.5:
        text = generate_long_text(text)
    good_data.append((text, 0))

# Генерируем 1500 "террористических" сообщений
for _ in range(1500):
    text = random.choice(terror_messages)
    text = add_variations(text)
    if random.random() > 0.5:
        text = generate_long_text(text)
    bad_data.append((text, 1))

# Смешиваем данные
all_data = good_data + bad_data
random.shuffle(all_data)

# Сохраняем в CSV
with open('emails.csv', mode='w', encoding='utf-8', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['text', 'label'])
    for text, label in all_data:
        writer.writerow([text, label])

print("✅ CSV файл 'emals.csv' создан с 3000 строками.")
print("   - 1500 нормальных сообщений")
print("   - 1500 террористических сообщений")
print("   - Включены: прямые угрозы, призывы к насилию, угрозы бомбы, фальшивки, неявные агрессивные угрозы")